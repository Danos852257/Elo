<!--  "¯\_(ツ)_/¯"  -->

<!DOCTYPE html>
<html>
<head>
    <!--probably need something here for the UI but worry about that later-->
    <title>Elo</title>
    <link href="style.css" rel="stylesheet">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <meta charset = "UTF-8">
</head>
<body>
    <!--Main Code-->
    <script src = "player.js"></script>


    <script>
        //send to the login page if they are not logged in
        if(!localStorage.getItem("username")){
            localStorage.clear();
            window.location.href = "login.html";
        };
    </script>
    <script>
        //redirect user to the homepage if no competition is selected
        if(!localStorage.getItem("selectedCompetition")){
            window.location.href = "./homepage.html";
        }
    </script>




    <div class="topnav">
        <a class="active" href="#home">Home</a>
        <a href="about.html">About</a>
    </div>

    <!--Logout button stuff-->
    <button id = "logout">Logout</button>
    <script>
        document.getElementById("logout").addEventListener("click", function(){
            localStorage.clear();
            window.location.href = "login.html";
        });
    </script>



    

    <script>
        const currentComp = JSON.parse(localStorage.getItem("selectedCompetition"));
        var players = [];
        for(var i = 0; i < currentComp.playerData.length; i++){
            players.push(currentComp.playerData[i]);
        }
        console.log(players);


        var a = randomInt(1, players.length);
        var b = diffRandomInt(a, 1, players.length); //ensures that the same player is not chosen twice
    </script>
    
    


    <div style="display:flex; width: 100%; height: 100vh;"">
        <div id="leftSide" style="flex: 7; padding: 20px">
            <button id="button-1" class="option"></button>
            <button id="button-2" class="option"></button>
        </div>
        
        
        <div id="rightSide" style="flex: 3; padding: 20px;">
            <button id="showRankings">Show Rankings</button>
            <ul id="rankingsList"></ul>
        </div>
    </div>
    
    <style>
        .show-border {
            border-left: 1px solid #ccc;
        }
    </style>






    <button id="save" class="rankingExit">Save and Exit</button>
    <button id="cancel" class="rankingExit">Cancel</button>



    <script>
        function updateRankingsDisplay() {
            const rankingsList = document.getElementById("rankingsList");
            rankingsList.innerHTML = ""; // Clear the current list

            players.forEach((player, index) => {
                const listItem = document.createElement("li");
                listItem.textContent = `${index + 1}. ${player.name} ${scoreToDisplay(player.score)}`;
                rankingsList.appendChild(listItem);
            });
        }
    </script>




    <script>
        document.getElementById("showRankings").addEventListener("click", function(){
            const rankingsContainer = document.getElementById("rightSide");
            const rankingsList = document.getElementById("rankingsList");

            //switch between show and hide
            if(this.innerHTML === "Show Rankings"){
                updateRankingsDisplay();
            }
            else{
                this.innerHTML = "Show Rankings"
                rankingsList.innerHTML = "";
                rankingsContainer.classList.remove("show-border");
            }
            rankingsContainer.classList.remove("hidden");

        });
    </script>
    

    

    


    <script>
        let screenWidth = window.innerWidth;
        let screenHeight = window.innerHeight;

        let b1 = document.getElementById("button-1")
        let b2 = document.getElementById("button-2")
        b1.innerHTML = players[a].name;
        b2.innerHTML = players[b].name;


        b1.style.position = "absolute";
        b1.style.left = (screenWidth/2-225)+'px';
        b1.style.top = (screenHeight/2 -50)+'px';
        
        b2.style.position = "absolute";
        b2.style.left = (screenWidth/2 + 25)+'px';
        b2.style.top = (screenHeight/2 -50)+'px';


        b1.addEventListener("click", function () {
            updateScores(players[a], players[b])

            a = randomInt(1, players.length);
            b = diffRandomInt(a, 1, players.length);
            b1.innerHTML = players[a].name;
            b2.innerHTML = players[b].name;

            players = sortPlayers(players);
            updateRankingsDisplay();
        })

        b2.addEventListener("click", function(){
            updateScores(players[b], players[a])

            a = randomInt(1, players.length);
            b = diffRandomInt(a, 1, players.length);
            b1.innerHTML = players[a].name;
            b2.innerHTML = players[b].name;

            players = sortPlayers(players);
            updateRankingsDisplay();
        })
    </script>
    






    <!--Bottom 2 buttons to exit this page-->
    <script>
        document.getElementById("save").addEventListener("click", function(event){
            event.preventDefault();
            console.log(currentComp.PK);
            fetch(`${hyperlink}/sendRankingResults`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    PK: currentComp.PK,
                    playerData: players,  // Send the processed playerData JSON
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                if (data.success) {
                    window.location.href = './homepage.html';
                } else {
                    alert('Error: ' + data);
                }
            }).catch(error => {
                console.error("Error:", error);
            });
        });

        document.getElementById("cancel").addEventListener("click", function(event){
            localStorage.removeItem("selectedCompetition");
            window.location.href = "./homepage.html";
        });
    </script>
    
</body>
</html>